{{ define "main" }}
<article class="content-single">

  <!-- メインビジュアル -->
  {{ if .Params.image }}
  <div class="content-hero">
    <img src="{{ .Params.image }}" alt="{{ .Title }}">
  </div>
  {{ end }}

  <!-- ヘッダー -->
  <header class="content-header">
    <h1>{{ .Title }}</h1>
    <div class="content-meta">
      <span class="date">{{ .Date.Format "2006-01-02" }}</span>
      {{ with .Params.categories }}
        <span class="category">{{ index . 0 | upper }}</span>
      {{ end }}
      {{ with .Params.author }}
        <span class="author">{{ . }}</span>
      {{ end }}
    </div>
    {{ with .Params.summary }}
      <p class="content-summary">{{ . }}</p>
    {{ end }}
  </header>

  <!-- 本文 -->
  <div class="content-body">
    {{ .Content }}
  </div>

  <!-- 関連作品 -->
  {{ $current := . }}
  {{ $category := index .Params.categories 0 }}
  {{ $allWorks := where .Site.RegularPages "Section" "works" }}
  {{ $related := slice }}

  {{ range $allWorks }}
    {{ if and (ne .Permalink $current.Permalink) (in .Params.categories $category) }}
      {{ $related = $related | append . }}
    {{ end }}
  {{ end }}

  {{ $related = first 3 $related }}

  {{ if gt (len $related) 0 }}
  <section class="related-content">
    <h2>Related Works</h2>
    <div class="content-grid">
      {{ range $related }}
      <a class="related-card" href="{{ .RelPermalink }}">
        {{ if .Params.image }}
          <img src="{{ .Params.image }}" alt="{{ .Title }}">
        {{ else }}
          <img src="/img/noimage.png" alt="No image">
        {{ end }}
        <div class="related-info">
          <h3>{{ .Title }}</h3>
          {{ with .Params.summary }}
            <p>{{ . | plainify | truncate 60 }}</p>
          {{ end }}
        </div>
      </a>
      {{ end }}
    </div>
  </section>
  {{ end }}

</article>
{{ end }}
